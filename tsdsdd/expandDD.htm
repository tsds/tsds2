<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 <html>
 	<head>
 		<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
 		<title>DD Expander</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
 		<script src="tests/expandDD.tests.js"></script>
 		<script>

 		function range(start, stop, step) {
 	 		  var step = parseInt(step || "1");
 	 		  var a = parseInt(start);
 	 		  var b = parseInt(stop);
 	 		  var s = "";
 	 		  var i = a-step;
 	 		  while (i < b) {s = s + (i+step) + ",";i = i+step;};
 	 		  return s.slice(0,-1);
 	 	}
 		
 		function expand(list,Columns) {
 			//list = list.replace(/\(()\)|\[\]/g,"");
 	 		list = list.replace(/(\d+)-(\d+)/g,         function (match,a,b){return range(a,b)});
 			list = list.replace(/(\d+)\:(\d+)\:(\d+)/g, function (match,a,b,step){return range(a,b-1,step)})
 			list = list.replace(/(\d+)\:(\d+)/g,        function (match,a,b){return range(a,b-1,1)});
 			list = list.replace(/\((.*?)\)|\[(.*?)\]/g, function (match,a,b,step){return match.replace(/,/g,";")});			
 	 		var List = new Array();
 			if (list !== "") {
 				console.log("++");
 				console.log(list);
 				console.log(Columns);
 				console.log(List);
 				if (1) {
	 				var j = 0;
	 				var tmp = list.split(",");
	 				console.log("tmp");
	 				console.log(tmp);
					while (j < tmp.length) {
							List[j]=tmp[j];
	 						List[j]=tmp[j].replace(/;/g,",");
							console.log(tmp[j]);
	 						console.log(List);
	 						console.log(j + " ... " + List[j]);
	 						j=j+1;
	 				}
 				} else {
 					list.split(",").forEach(function (el,i) {
 		 					List[i] = el.replace(/;/g,",")});
							console.log(i + " " + List[i]);
 				}
 				console.log(list);
 				console.log(Columns);
 				console.log(List);
 			}
 			//return List;
 			if (Columns) {
 	 			console.log("--");
 	 			console.log(Columns);
 	 			console.log(List);
 	 			if (List.length > Columns.length) {
 					console.log("Array generated by input is longer than Columns array.  Removing elements from end.");
 					List.splice(0,Columns.length-1);
 				}
 				if (1) {
					var i = 0;
		 			while (i < List.length) {
	 		 			List[i] = List[i].replace(/\(\:\)/g,function () {return "(" + range(0,Columns[i].split(",").length-1) + ")"});
	 		 			List[i] = List[i].replace(/\[\:\]/g,function () {return "[" + range(0,Columns[i].split(",").length-1) + "]"});
	 					//List[i] = List[i].replace(/\(|\)|\[|\]/g,"");
			 			i=i+1;
		 			}
 				} else {
	 	 			List.forEach(function (el,i) {
	 		 			List[i] = el.replace(/\(\:\)/g,function () {return "(" + range(0,Columns[i].split(",").length-1) + ")"});
	 		 			List[i] = el.replace(/\[\:\]/g,function () {return "[" + range(0,Columns[i].split(",").length-1) + "]"});
	 					List[i] = List[i].replace(/\(|\)|\[|\]/g,"")})
 				}
 	 			console.log("++--");
 	 			console.log(Columns);
 	 			console.log(List);
 				if (List.length < Columns.length) {
 	 				console.log("Array generated by input is shorter than Columns array.  Appending elements to end.");
 	 				if (List[List.length-1] === ":") {
 	 					// Special case when last part of string is ":"
 	 					console.log("xhere");
 	 					List.pop();
 	 					var j = 0;
 	 					while (j < Columns.length) {List.push(""+j);j=j+1;}
 	 				} else {
 	 	 				console.log("here");
 	 	 				var j = 0;
 	 	 				while (j < Columns.length) {
 	 	 	 				List[j] = "";
 	 	 	 				if (Columns[j].match(/\(/)) List[j] = "()";
 	 	 	 				if (Columns[j].match(/\[/)) List[j] = "[]";
 	 	 	 				j = j+1;
 	 	 	 			}
 	 				}
 	 			}
 				console.log("xxxxx")
 	 			console.log(Columns);
 				console.log(List);
 				if (List[List.length-1] === ":") {
	 				console.log("****")
	 				console.log(List);
	 				console.log(List[0]);
	 				console.log(List[1]);
	 				// Special case where (:) or [:] was meant at the end, but : was given.
	 				List[List.length-1] = "";
	 				console.log(List);
	 				var j = 0;
 	 				while (j < Columns[List.length-1].match(/\d+,/g).length+1) {List[List.length-1] += ""+j+",";j=j+1;}
 	 				List[List.length-1] = List[List.length-1].replace(/,$/,"");
 	 				if (Columns[List.length-1].match(/^\(/)) {
 	 	 				List[List.length-1] = "(" + List[List.length-1] + ")";
	 					$("<p>Warning: Last element given is : but only (:) makes sense.  Assuming (:).</p>").appendTo($('#columnLabelValuesError'))
 	 				}

 	 				if (Columns[List.length-1].match(/^\[/)) {
 	 	 				List[List.length-1] = "[" + List[List.length-1] + "]"
	 					$("<p>Warning: Last element given is : but only [:] makes sense.  Assuming [:].</p>").appendTo($('#columnLabelValuesError'))
 	 				};

 	 			}
 			}
	 		return List;
 		}

		function runtest(j) {
			j = parseInt(j);
	 		Tests[j].groupTypes = new Array();
	 		//expand(Tests[j].columns);
	 		//return;
	 		[].forEach(function (el,i) {
	 							Tests[j].groupTypes[i] = "scalar";
			 					if (el.match(/\[/)) {Tests[j].groupTypes[i] = "spectrogram"}
			 					if (el.match(/\(/)) {Tests[j].groupTypes[i] = "vector"}})
			console.log("Test results");
			Tests[j].Columns = expand(Tests[j].columns);
			$("#columns").val(JSON.stringify(Tests[j].columns));
			$("#Columns").val(JSON.stringify(Tests[j].Columns));
	 		err = false;
	 		console.log("==" + Check[j].Columns.length);
	 		for (var k=0;k<Check[j].Columns.length;k++) {
	 			if (Tests[j].Columns[k] !== Check[j].Columns[k]) {
					$("<p>Error in expanded array element at index " + k + ". Expected " + Check[j].Columns[k] + ". Found " + Tests[j].Columns[k] + ".</p>").appendTo($('#columnError'));
					err = true;
			 	}
				console.log(Tests[j].Columns[k] === Check[j].Columns[k])
	 		}
	 		if (!err) {$("<p>OK</p>").appendTo($('#columnError'))};
	 		
			Tests[j].ColumnLabelValues = expand(Tests[j].columnLabelValues,Tests[j].Columns);

			$("#columnLabelValues").val(JSON.stringify(Tests[j].columnLabelValues));
	 		$("#ColumnLabelValues").val(JSON.stringify(Tests[j].ColumnLabelValues));
	 		for (var k=0;k<Check[j].ColumnLabelValues.length;k++) {
				err = false;
	 			if (Tests[j].ColumnLabelValues[k] !== Check[j].ColumnLabelValues[k]) {
					$("<p>Error in expanded array element at index " + k + ". Expected " + Check[j].ColumnLabelValues[k] + ". Found " + Tests[j].ColumnLabelValues[k] + ".</p>").appendTo($('#columnLabelValuesError'));
					err = true;
			 	}
	 			console.log(Tests[j].ColumnLabelValues[k] === Check[j].ColumnLabelValues[k])
	 			
	 		}
	 		if (!err) {$("<p>OK</p>").appendTo($('#columnLabelValuesError'))};

		}
 		$(document).ready(function(){

			$("#presets").append("<select id='presetselect' style='height:2.0em;width:100%'/>");
			$("#presetselect").append("<option id='title'>-Tests-</option>");
			for (i = 0; i < Tests.length; i++) {
				var o = $("<option/>").attr("id",i).html(i+1 + ". columns=" + Tests[i].columns + ", columnLabelValues=" + Tests[i].columnLabelValues);
				$("#presetselect").append(o);
			}
			$("#presetselect").change(function () {
				$('#columnError').html('');
				$('#columnLabelValuesError').html('');
				var id = $(this).find("option:selected").attr("id");
				runtest(id);
 			})
			$('#presetselect').find('option:eq(1)').attr('selected', true).trigger("change");


			$('#expandcolumns').click(function () {
				$("#columnError").text("");
				$("#Columns").val(expand($("#columns").val()))});

			$('#expandcolumnLabelValues').click(function () {
				$('#expandcolumns').click();
				$("#columnLabelValuesError").text("");
				var tmp1 = expand($("#columns").val());
				var tmp2 = $("#columnLabelValues").val();
				$("#ColumnLabelValues").val(expand(tmp2,tmp1))});
			
		})

 		</script>
	</head>
	<body>
	<div id="presets" style="width:30em">
	</div>
	
	<div style="width:50%">
		<br/>
		columns given
		<br/>
		<input id="columns" style="width:30em"type="text"></input><input type="button" id="expandcolumns" class="try" value="Expand">
		<br/>
		columns expanded
		<br/>
		<input id="Columns" style="width:30em"type="text"></input>
		<div id="columnError"></div>
		<br/>		
		columnLabelValues given
		<br/>
		<input id="columnLabelValues" style="width:30em"type="text"></input><input id="expandcolumnLabelValues" type="button" class="try" value="Expand">
		<br/>
		columnLabelValues expanded
		<br/>
		<input id="ColumnLabelValues" style="width:30em"type="text"></input>
		<div id="columnLabelValuesError"></div>
		
	</div>
	</body>
</html>
