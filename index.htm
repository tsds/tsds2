<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 <html>
 	<head>
 		<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
 		<title>TSDS Generator</title>
		<link rel="stylesheet" href="deps/codemirror-2.3/lib/codemirror.css">		
 		<link rel="stylesheet" type="text/css" href="asset/main.css">
 		<link rel="icon" type="image/ico" href="asset/favicon.ico"/>

 		<script type="text/javascript" src="deps/1.7.2/jquery.min.js"></script>
 		<script type="text/javascript" src="deps/autosize/jquery.autosize-min.js"></script>
 		<script type="text/javascript" src="deps/jquery.scrollTo-min.js"></script>
		<script type="text/javascript" src="deps/jquery.tmpl.js"></script>
		<script type="text/javascript" src="deps/jquery.imagesloaded.js"></script>

 		<script type="text/javascript" src="../expandtemplate/deps/strftime.js"></script>
 		<script type="text/javascript" src="../expandtemplate/deps/sprintf-0.7-beta1.js"></script>	
 		<script type="text/javascript" src="../expandtemplate/deps/date.js"></script>
 		<script type="text/javascript" src="../expandtemplate/lib/expandtemplate.js"></script>  		

		<script src="deps/codemirror-2.3/lib/codemirror.js"></script>
		<script src="deps/codemirror-2.3/mode/xml/xml.js"></script>
		<script src="deps/codemirror-2.3/lib/util/formatting.js"></script>

 		<script type="text/javascript" src="asset/checkproxy.js"></script>
 		<script type="text/javascript" src="asset/tsdsgen.js"></script>
		<script type="text/javascript">Presets = {};</script>
 		<script type="text/javascript" src="presets/USGS-RT-1M.js"></script>
 		<script type="text/javascript" src="presets/USGS-RT-1M-FRD.js"></script> 		
 		<script type="text/javascript" src="presets/USGS-RT-1S.js"></script>
 		<script type="text/javascript" src="presets/CCMC-BATSRUS-4M.js"></script>
		<script type="text/javascript" src="presets/linkcheck-autoplot.js"></script>
 		<script type="text/javascript" src="asset/setpresets.js"></script>
 		<script type="text/javascript" src="asset/createcatalog.js"></script>
 	</head>
	<script>
		var AutoplotServlet  = "http://autoplot.org/plot/SimpleServlet?";
		//var AutoplotServlet  = "http://plasma.gmu.edu:8082/AutoplotServlet/SimpleServlet?";
		var plotoptions      = "width=500&height=100&font=sans-8&format=image%2Fpng&column=10em%2C100%25-3em&row=1em%2C100%25-4em&renderType=&color=%230000ff&fillColor=%23aaaaff&foregroundColor=%23ffffff&backgroundColor=%23000000";

		var DataCache        = "http://datacache.org/dc/sync";
		// This won't work for localhost. node.js gives Error: getaddrinfo ENOENT.
		//var DataCache        = "http://localhost:8000/sync";
		//var DataCache        = "http://127.0.0.1:8000/sync";

		var URLTemplateExpander = "";
		
		var Proxy            = "";
		var Proxy            = "http://localhost:8888/proxy?url=";
		var Proxy            = "http://127.0.0.1:8002/proxy?url=";
		//var Proxy            = "asset/head.php?url=";
		
		function threddsTry() {
			data = "catalog=" + escape($('#threddscatalog').val());
			$.ajax({
				type: 'POST',
				data: data,
				url: 'asset/proxy.php', 
				success: function () {},
				error: function () {}});
		}
		
		function autoFormat(editor) {
		    var totalLines = editor.lineCount();
		    var totalChars = editor.getTextArea().value.length;
		    editor.autoFormatRange({line:0, ch:0}, {line:totalLines, ch:totalChars});
		}

		$(document).ready(function(){
		
			$("#presets").append("<select id='presetselect' style='height:2.0em;width:100%'/>");
			$("#presetselect").append("<option id='title'>-Presets-</option>");
			first = true;
			for (var i in Presets) {
				var o = $("<option/>").attr("id",i).html(i);
				if (first) {o.attr("selected","selected");first=false};
				$("#presetselect").append(o);
			}
			$("#presetselect").change(function () {
				var id = $(this).find("option:selected").attr("id");
				
				// Needed for autosize to work after change.
				// Otherwise content does not change (at least in Chrome).
				$("#Datasets").remove(); 
				$("#ds").after("<textarea class='enter' id='Datasets'>")
				
				setpresets(Presets[id]);
				expand();
				$('#Datasets').autosize();
				str = createcatalog();
				$(".CodeMirror").remove();
				//$('#threddscatalog2').empty().val(str);
				$('#threddscatalog').empty().val(str);
				
				//var editor = CodeMirror.fromTextArea(document.getElementById('threddscatalog'), {lineNumbers:true,"mode":"xml", "value": catalog[0].outerHTML.replace(/\s.*\</g,'')});
				var editor = CodeMirror.fromTextArea(document.getElementById('threddscatalog'), {lineNumbers:true,"mode":"xml"});
				autoFormat(editor);
			})
			$("#presetselect").trigger("change");
			$("#DataColumns").val().split(/\(|\)/g).forEach(function (el,idx,arr) {el = el.replace(/^,|,$/,"");console.log(idx + " " + el)});
			

		});

		</script>
 	<body>
 	<div id="submiturl"></div>
 	<div style="width:50%">
 	<div id="presets"></div>
 	
 	<form id="form" action="/" method="post">
 		<input type="submit" class="try" value="Submit">
	<hr/>
		* Catalog ID
 		<br/>
 		<input class="enter" type="text" id="CatalogID"></input>
 		<br/>
		* Catalog Name
 		<br/>
 		<input class="enter" type="text" id="CatalogName"></input>
 		<br/>
		Catalog Description (If not specified, Catalog Name is used.)
 		<br/>
		<input class="enter" type="text" id="CatalogDescription"></input>
 		<br/>
		Catalog Description URL 
 		<br/>
 		<input class="enter" type="text" id="CatalogDescriptionURL"></input>
 		<br/>
 		* Dataset information (one line per).  Each dataset line must have a Dataset ID, [Dataset Description, other info].
 		<br id="ds">
 		<textarea class="enter" id="Datasets"></textarea>
 		<br/>
 		 * Start Date(s) (YYYY-MM-DD) (one or one per dataset - comma or newline separated)
 		<br/>
		<textarea class="enter" id="StartDates"></textarea>
 		<br/>
 		* Stop Date(s) (YYYY-MM-DD) (one or one per dataset - comma or newline separated)
 		<br/>
		<textarea class="enter" id="StopDates"></textarea>
 		<br/>
 		URL template script 
 		<textarea class="enter" id="URLTemplateScript"></textarea>
		<br/>
 		URL template expander 
 		<input type="text" id="URLTemplateExpander"></input>
 		<input type="button" class="try" value="Expand">
		<br/>
 		* URL template ($1 refers to Dataset ID, $2 refers to Dataset Description, etc.  %Y = four-digit year, %m = two-digit month, %d = two-digit day.)
 		<input type="text" id="URLTemplate" class="enter"></input>
 		<input type="button" class="try" value="Expand">
 	<br/>	
 		Data URLs (Generated by expanding $ wildcards for each Dataset and % wildcards for entire timerange.) 
 		<br/>
  		<textarea id="urls" class="try" style="display:none"></textarea>
  		<div id="urls" class="try" style="display:none"></div>
  		Plot configuration file: <input type="text" id="VAP" value="http://tsds.org/tsds/default.vap"></input>
 		<br/>  		
 		Plot columns: <input type="text" id="PlotColumns"></input>
 		<br/>  		
 		<input id="report0dataurls" type="button" onclick="ajaxRequest(this,'HEAD');" value="HEAD check">
 		<input id="report1dataurls" type="button" onclick="ajaxRequest(this,'GET');" value="GET check (slow)">
	 	<input id="report2dataurls" type="button" onclick="ajaxReport(this,'report');" value="Report (slow)">
 	 	<input id="report3dataurls" type="button" onclick="ajaxReport(this,'plot');" value="Plots (slow)">
		<br/>
 		<div id="urlsvalid" style="display:none">
	 		Valid data urls
	 		<br/>
	  		<textarea id="urlsv" class="try"></textarea>
	 		<br/>
 		</div>
 		<div id="urlsinvalid" style="display:none">
	 		Invalid data urls
	 		<br/>
	  		<textarea id="urlsi" class="try"></textarea>
	 		<br/>
 		</div>
		<br/>
 		<span id="report0dataurls_span" style="display:none"><span id="report0dataurls_results"></span></span>
	 	<span id="report1dataurls_span" style="display:none"><span id="report1dataurls_results"></span></span>
	 	<span id="report2dataurls_span" style="display:none"><span id="report2dataurls_results"></span></span>
		<span id="report3dataurls_span" style="display:none"><span id="report3dataurls_results"></span></span>
 	<hr/>
		* Time Columns <input id="tryTimeColumns" type="button" class="guessajax" value="Try">
  		<input type="text" id="TimeColumns"></input>
 		<br/>
		* Time Format <input id="tryTimeFormat" type="button" class="guessajax" value="Try">
  		<input type="text" id="TimeFormat"></input>
 		<br/>
		* Time Units (if empty, and time is one column, is assumed to be ISO861)<input id="tryTimeUnits" type="button" class="guessajax" value="Try">
  		<input type="text" id="TimeUnits"></input>
 		<br/>
		* Time Labels <input id="tryTimeLabels" type="button" class="guessajax" value="Try">
  		<input type="text" id="TimeLabels"></input>
  		<br/>
		<br/>
 		* Data Columns <input id="tryDataColumns" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataColumns"></input>
 		<br/>
		* Data Column IDs <input id="tryDataIDs" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataIDs"></input>
 		<br/>
		* Data Column Names <input id="tryDataNames" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataNames"></input>
 		<br/>
		* Data Column Labels <input id="tryDataLabels" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataLabels"></input>
 		<br/>
		* Data Column Values <input id="tryDataValues" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataValues"></input>
 		<br/>
		* Data Column Types <input id="tryDataTypes" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataTypes"></input>
 		<br/>
		* Data Column Units <input id="tryDataUnits" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataUnits"></input>
 		<br/>
		* Data Column Renderings <input id="tryDataRenderings" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataRenderings"></input>
 		<br/>
		* Data Column Fill Values <input id="tryDataFillValues" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataFillValues"></input>
 		<br/>
 		<br/>
		* Data Column Group IDs <input id="tryDataGroupIDs" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataGroupIDs"></input>
 		<br/>
		* Data Column Group Names <input id="tryDataGroupNames" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataGroupNames"></input>
 		<br/>
		* Data Column Group Labels <input id="tryDataGroupLabels" type="button" class="guessajax" value="Try">
  		<input type="text" id="DataGroupLabels"></input>
 		<br/>
		<br/>
 		* Skip lines <input id="trySkipLines" type="button" class="guessajax" value="Try">
 		<br/>
 		<input type="text" id="SkipLines"></input>
 		<br/>
 		* Data line regular expression <input id="tryLineRegEx" type="button" class="guessajax" value="Try">
 		<br/>
 		<input type="text" id="LineRegEx"></input>
 		<br/>
 		* Non-data line regular expression <input id="tryCommentCharacter" type="button" class="guessajax" value="Try">
 		<br/>
 		<input type="text" id="CommentCharacter"></input>
 		<br/>
 		* Data delimiter <input id="tryDataDelimiter" type="button" class="guessajax" value="Try">
		<input type="text" id="DataDelimiter"></input>
 		<br/>
 		* Data line format <input id="tryDataLineFormat" type="button" class="guessajax" value="Try">
 		<input type="text" id="DataLineFormat"></input>
		<br/>
 		* IOSP <input id="tryIOSP" type="button" class="guessajax" value="Try">
 		<input type="text" id="IOSP"></input>
	<hr/>
 		<div id="catalogdiv" style="display:none">
			<input id="threddscatalogtry" type="button" onclick="threddsTry();" value="Try"> catalog.thredds:
		 	<textarea class="try" id="threddscatalog"></textarea>
			<br/>
		<div id="catalogdiv2" style="display:none">
			catalog.xml:
			<br/>
		 	<textarea class="try" id="tsdscatalog"></textarea>
		 	
			<textarea class="try" id="tsdstemplate" style="display:none">
			        <catalog>
			                <name>${CatalogName}</name>
			                <id>${CatalogID}</id>
			                <urlgenerator>${urlgenerator}</urlgenerator>
			                <ncml>
			                        <generator>http://tsds.net/catalogs/TSDS-ncml.xsl</generator>
			                        <iosp>${IOSP}</iosp>
			                        <timecols>${TimeColumns}</timecols>
			                        <timefmt>${TimeFormat}</timefmt>
			                </ncml>
			        </catalog>
			</textarea>

		 	<textarea class="try" id="threddstemplate" style="display:none">
				<catalog xmlns:xlink="http://www.w3.org/1999/xlink" name="" id="">
    					<documentation xlink:href="" xlink:title=""/>
    					<service name="tss" serviceType="OpenDAP" base=""/>
						<dataset name="" id="">
							<access serviceName="tss" urlPath=""/>
							<access serviceName="ncml" urlPath=""/>
							<timeCoverage>
								<Start></Start>
								<End></End>
							</timeCoverage>
							<groups>
								<group id="" version="" name="" type="" elements="" values=""/>
							</groups>
							<variables>
								<variable name="" label="" units="" id="" version="" type="" columns="" delim="" regex="" commentCharacter="" skipLines="" format="" renderings="" fillvalues="" urlgenerator="" urltemplate="" urlpreprocess="" timecolumns="" timeformat="" timestart="" timeend=""/>
							</variables>
					</dataset>
				</catalog>
		 	</textarea>
		</div>
		<br/>
 		<div id="dlscript" style="display:none">
	 		Download Script
	 		<br/>
	  		<textarea id="script" class="try" ></textarea>
 		</div>
 	</form>
 	</div>
 	</body>
 </html>