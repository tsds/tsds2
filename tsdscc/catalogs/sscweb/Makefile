CAT=SSCWeb

all: catalog

catalog: $(CAT)-tsds.xml


src/txtcatalog.class: src/txtcatalog.java 
	cd src; javac -cp ../jar/jaxws-rt-2.0EA3.jar:../jar/sscWS-client.jar txtcatalog.java

src/xmlcatalog.class: src/xmlcatalog.java
	cd src; javac xmlcatalog.java

$(CAT).raw: src/txtcatalog.class
	java -cp jar/jaxws-rt-2.0EA3.jar:jar/sscWS-client.jar:src txtcatalog > $(CAT).raw

$(CAT)-tsds.xml: $(CAT).raw src/xmlcatalog.class
	java -cp src xmlcatalog $(CAT).raw > $(CAT)-tsds.xml

clean:
	- rm -f *.raw
	- rm -f src/*.class
	- rm -f $(CAT)*.xml*


#all: clean autoplot catalog clean

XSLT=F2C6DDE1-5948-B63B-9581-E24C096A3254
CATAP=SSCWeb-autoplot
RAW=$(CAT)-$(DATE2).raw

# Only Autoplot bookmarks use the XSLT.  TSDS catalog is generated by xmlcatalog.java.
# TODO: Create Autoplot bookmarks file from within TSDSFE and based on 
XML2THREDDS=http://virbo.org/exist/servlet/db/virbo/xq/xsltransform.xql?xslt=http://virbo.org/meta/viewDataFile.jsp%3Fdocname=$(XSLT)%26filetype=data

# sudo apt-get install libsaxon-java
# Using libsaxon does not work with above input file.

autoplot: $(CATAP).xml

$(CATAP).xml: $(CAT).raw
	wget -O $(CATAP).xml "$(XML2THREDDS)&output=autoplot"
	gzip -c $(CATAP).xml > $(CATAP).xml.gz

$(CAT).json: $(CAT).raw
	perl -ne 'print if /^Satellites/ .. /^Time to execute getAllSatellites/' $(CAT).raw | grep "^\s" | sed "s/\s\-\s/\-/" | sed "s/\s\s*/,/g" | tr "\n" " " | sed 's/^/var sscwebdata = "/' | sed 's/$/"/' > SSCWeb.json

