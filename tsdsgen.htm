<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 <html>
 	<head>
 		<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
 		<title>TSDS Generator</title>
 		<link rel="stylesheet" type="text/css" href="asset/main.css">
 		<link rel="icon" type="image/ico" href="asset/favicon.ico"/>

 		<script type="text/javascript" src="deps/1.7.2/jquery.min.js"></script>
 		<script type="text/javascript" src="deps/autosize/jquery.autosize-min.js"></script>
 		<script type="text/javascript" src="deps/strftime.js"></script>
 		<script type="text/javascript" src="deps/sprintf-0.7-beta1.js"></script>	
 		<script type="text/javascript" src="deps/date.js"></script>
 		<script type="text/javascript" src="deps/jquery.scrollTo-min.js"></script>

 		<script type="text/javascript" src="asset/checkproxy.js"></script> 		
 		<script type="text/javascript" src="presets/USGS-RT-1M.js"></script>
 		<script type="text/javascript" src="tsdsgen.js"></script>
 	</head>
	<script>
		var AutoplotServlet = "http://autoplot.org/plot/SimpleServlet?";
		var 	plotoptions     = "width=500&height=100&font=sans-8&format=image%2Fpng&column=10em%2C100%25-3em&row=1em%2C100%25-4em&renderType=&color=%230000ff&fillColor=%23aaaaff&foregroundColor=%23ffffff&backgroundColor=%23000000";

		var DataCache       = "http://datacache.org/dc/sync";
		var DataCache       = "http://localhost:8000/sync";
	
		var Proxy           = "";
		var Proxy           = "http://localhost:8002/proxy?url=";

		$(document).ready(function(){
			$('#CatalogName').val(CatalogDescription["Name"]);
			$('#CatalogID').val(CatalogDescription["ID"]);
			$('#CatalogDescription').val(CatalogDescription["Description"] || CatalogDescription["Name"]	);
			$('#Template').val(Template);
			$('#LineTemplate').val(LineTemplate);
			$('#LineRegex').val(LineRegex);
			$('#ColumnUnits').val(ColumnUnits);
	
			var tmp = JSON.stringify(DatasetDescription).replace(/\],\[/g,"\n").replace("[[","").replace("]]","").replace(/\"/g,"");
			$('#Dataset').text(tmp);
			
			$('#ColumnLabels').val(JSON.stringify(ColumnLabels));
			$('#ColumnLongnames').val(JSON.stringify(ColumnLongnames));
			$('#ColumnGroupings').val(JSON.stringify(ColumnGroupings));
			$('#ColumnGroupnames').val(JSON.stringify(ColumnGroupnames));
			$('#ColumnGrouptypes').val(JSON.stringify(ColumnGrouptypes));
			
			$('#startmin').val(Start);
			$('#stopmax').val(Stop);
			
			$('input[type=button].try').click(
				function () {
					$(this).val('');						
					$(this).each(function() {expandtemplate(this)});
					links();
				});

			$('textarea.enter').autosize();

			if (0) {
				$('textarea.try').autosize();
				
				$("textarea.try").toggle(
								function () {
									$(this).trigger("oninput"); // Trigger autosize event.
								},	
								function () {
									$(this).height("5.5em")
								});
			}
				
			//setInterval(detectchange,500);
			setTimeout(
					function () {
						$('input[type=button].try').click();
						dlscript();
						//$('input[type=button].try').eq(5).click();
						// Create THREDDS catalog
						//catalog($('#Dataset').val().split("\n")); 
					}, 10);

		});

		</script>
 	<body>
 	<div id="submiturl"></div>
 	<div style="width:50%">
 	<form id="form" action="/" method="post">
 		<input type="submit" class="try" value="Submit">
	<hr/>
		* Catalog Name
 		<br/>
 		<input class="enter" type="text" id="CatalogName"></input>
 		<br/>
		* Catalog ID
 		<br/>
 		<input class="enter" type="text" id="CatalogID"></input>
 		<br/>
		Catalog Description (If not specified, Catalog Name is used.)
 		<br/>
 		<input class="enter" type="text" id="CatalogDescription"></input>
 		<br/>
 		* Column units
 		<br/>
 		<input type="text" id="ColumnUnits"></input>
 		<br/>
 		 * Start date min (YYYY-MM-DD)
 		<br/>
 		<input type="text" id="startmin" class="enter"></input>
 		<br/>
 		<div style="display:none;">
	 		Start dates <span id="guessstartnote" style="display:none"></span>
	 		<br/> 		
	 		<textarea id="startdates" class="try"></textarea>
	 		<br/>
	 		<br/>
 		</div> 		
 		* Stop date max 
 		<br/>
	 	<input type="text" id="stopmax" class="enter"></input>
 		<div style="display:none;">
	 		Stop dates <span id="guessstopnote" style="display:none"></span>
	 		<br/> 		
	 		<textarea id="stopdates" class="try"></textarea>
	 		<br/> 		
	 		<br/>
 		</div>
 		<br/>
 		* Datasets (one line per).  Each dataset must have a Dataset ID, [Dataset Description, other info].
 		<br>
 		<textarea class="enter" id="Dataset"></textarea>
 		<br/>
 		* URL template ($1 refers to ID, $2 refers to Dataset Description, etc.  %Y = four-digit year, %m = two-digit month, %d = two-digit day.)
 		<br/>
 		<input type="text" id="Template" class="enter"></input>
 		<input type="button" class="try" value="Expand">
 		<br/>
 		* Data line regular expression <input id="trydataregex" type="button" class="guessajax" value="Try">
 		<br/>
 		<input type="text" id="LineRegex"></input>
 		<br/>
		* Data Line Template <input id="trydatatemplate" type="button" class="guessajax" value="Try">
  		<input type="text" id="LineTemplate"></input>
 		<br/>
 	<hr/>	
 		Data URLs (Generated by expanding $ wildcards for each Dataset and % wildcards for entire timerange.) 
 		<br/>
  		<textarea id="urls" class="try" style="display:none"></textarea>
  		<div id="urls" class="try" style="display:none"></div>
  		Plot configuration file: <input type="text" id="VAP" value="http://tsds.org/tsds/default.vap"></input>
 		<br/>  		
 		<input id="report0dataurls" type="button" onclick="ajaxRequest(this,'HEAD');" value="HEAD check">
 		<input id="report1dataurls" type="button" onclick="ajaxRequest(this,'GET');" value="GET check (slow)">
	 	<input id="report2dataurls" type="button" onclick="ajaxReport(this,'report');" value="Report (slow)">
 	 	<input id="report3dataurls" type="button" onclick="ajaxReport(this,'plot');" value="Plots (slow)">
		<br/>
 		<span id="report0dataurls_span" style="display:none"><span id="report0dataurls_results"></span></span>
	 	<span id="report1dataurls_span" style="display:none"><span id="report1dataurls_results"></span></span>
	 	<span id="report2dataurls_span" style="display:none"><iframe id="report2dataurls_results"></iframe></span>
		<span id="report3dataurls_span" style="display:none"><span id="report3dataurls_results"></span></span>
		<br/>
 		<br/>
 		<div id="urlsvalid" style="display:none">
	 		Valid data urls
	 		<br/>
	  		<textarea id="urlsv" class="try"></textarea>
	 		<br/>
	 		<br/>
 		</div>
 		<div id="urlsinvalid" style="display:none">
	 		Invalid data urls
	 		<br/>
	  		<textarea id="urlsi" class="try"></textarea>
	 		<br/>
	 		<br/>
 		</div>
 	<hr/>
 		Column labels for each Dataset ($1 refers to Dataset Description, $2 refers to ID, etc.)
 		<br/>
 		<input type='text' id="ColumnLabels" class="enter"></input>
 		<input type="button" class="try" value="Expand">
 		<br/>
 		<textarea class="try"></textarea>
 		<br/>
 		Column description for each dataset ($1 refers to ID, $2 refers to Dataset Description, etc.)
 		<br/>
 		<input type="text" id="ColumnLongnames" class="enter"></input>
		<input type="button" class="try" value="Expand">
 		<br/>
 		<textarea class="try"></textarea>
 		<br/>
 		Column groupings for each dataset ($1 refers to ID, $2 refers to Dataset Description, etc.)
 		<br/>
 		<input type="text" id="ColumnGroupings" class="enter"></input>
		<input type="button" class="try" value="Expand">
 		<br/>
 		<textarea class="try"></textarea>
 		<br/>
 		Column group names for each dataset ($1 refers to ID, $2 refers to Dataset Description, etc.)
 		<br/>
 		<input type="text" id="ColumnGroupnames" class="enter"></input>
		<input type="button" class="try" value="Expand">
 		<br/>
 		<textarea class="try"></textarea>
 		<br/>
 		Column group types for each dataset ($1 refers to ID, $2 refers to Dataset Description, etc.)
 		<br/>
 		<input type='text' id="ColumnGrouptypes" class="enter"></input>
		<input type="button" class="try" value="Expand">
 		<br/>
 		<textarea class="try"></textarea>
 		<br/>
 		<div id="dlscript" style="display:none">
	 		Download Script
	 		<br/>
	  		<textarea id="script" class="try"></textarea>
	 		<br/>
	 		<br/>
 		</div>
		<br/> 		
 		<div style="display:none">
			<br/>
			<br/>
			catalog.thredds:
			<br/>
		 	<textarea class="try" id="catalog"></textarea>
			<br/>
		</div>
 	</form>
 	</div>
 	</body>
 </html>